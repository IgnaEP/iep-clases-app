import streamlit as st
from streamlit_gsheets import GSheetsConnection
import pandas as pd

st.set_page_config(page_title="IEP Clases - NBA Dashboard", layout="centered")

st.title("üèÄ IEP Clases: Dashboard del Profe")
st.markdown("Bienvenido a la Liga. Aqu√≠ puedes ver tus estad√≠sticas y registrar tus partidos (clases).")

# Conexi√≥n con Google Sheets
conn = st.connection("gsheets", type=GSheetsConnection)

# 1. CARGAR DATOS
df = conn.read(worksheet="Registro_Clases")

# 2. LOGIN SIMPLE
nombre_profe = st.selectbox("Selecciona tu nombre de la lista:", df["Profesor"].unique())

if nombre_profe:
    # Filtrar datos por profe
    profe_df = df[df["Profesor"] == nombre_profe]
    
    # C√°lculos NBA en tiempo real
    pago_neto = (profe_df["Monto"].sum()) * 0.55
    escrow = (profe_df["Monto"].sum()) * 0.05
    total_horas = profe_df["Horas"].sum()

    # 3. PANTALLA PRINCIPAL (DASHBOARD)
    col1, col2, col3 = st.columns(3)
    col1.metric("Mis Ganancias", f"${pago_neto:,.2f}")
    col2.metric("Bono Escrow", f"${escrow:,.2f}")
    col3.metric("Horas Totales", f"{total_horas}h")

    st.divider()

    # 4. FORMULARIO PARA REGISTRAR CLASE
    with st.expander("‚ûï Registrar Nueva Clase"):
        with st.form("nueva_clase"):
            alumno = st.text_input("Nombre del Alumno")
            monto = st.number_input("Monto Cobrado ($)", min_value=0)
            horas = st.number_input("Horas de Clase", min_value=0.5, step=0.5)
            submit = st.form_submit_button("Finalizar Partido")
            
            if submit:
                # Aqu√≠ crear√≠amos la l√≥gica para guardar. Por ahora, simulaci√≥n:
                st.success(f"¬°Clase de {alumno} registrada! (Los datos se enviar√°n a tu Sheets)")

    # 5. HISTORIAL
    st.subheader("Historial de Clases")
    st.dataframe(profe_df[["Fecha", "Alumno", "Monto", "Horas"]], use_container_width=True)